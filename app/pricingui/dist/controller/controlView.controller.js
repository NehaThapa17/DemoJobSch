sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/core/BusyIndicator","demo/app/utils/constants"],function(e,t,i,a,s){"use strict";return e.extend("demo.app.controller.controlView",{onInit:function(){this.oBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.oDataModelT=this.getOwnerComponent().getModel();a.show();var e=new i;var t=[];e.setData(t);this.getView().setModel(e,"oModel");this.getOwnerComponent().setModel(e,"oModel");var s=sap.ui.core.UIComponent.getRouterFor(this);s.getRoute("RoutecontrolView").attachPatternMatched(this.onRouteControl,this)},getJSTime:function(){a.show();var e=this;this.oDataModelT.callFunction("/getJobDetails",{method:s.httpGet,success:function(t){a.hide();var i=JSON.parse(t.getJobDetails);if(i.RECURSIVE!==undefined){var d=new Date,r=i.RECURSIVE.indexOf(s.DIV),n=i.RECURSIVE.substring(s.INTZERO,r),u=i.RECURSIVE.substring(r+s.INTONE);d.setHours(n);d.setMinutes(u);var o=new Date(d.getTime()-d.getTimezoneOffset()*6e4);var l=o.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});e.getView().byId("idTimePickerInput").setDateValue(o);e.getView().byId("idTextDailyST").setText(l);e.getView().byId("idSwitchInput").setState(true);e.getView().byId("idTimePickerInput").setEnabled(false)}else{e.getView().byId("idTextDailyST").setText(s.SPACE);e.getView().byId("idTimePickerInput").setValue(s.SPACE);e.getView().byId("idSwitchInput").setState(false);e.getView().byId("idTimePickerInput").setEnabled(true)}if(i.ONDEMAND!==undefined){var d=new Date(i.ONDEMAND);var S=new Date(d.getTime()-d.getTimezoneOffset()*6e4);var l=S.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});var c=S.toDateString().replace(/^\S+\s/,""),o=c+s.SPACE+l;e.getView().byId("idTextOnDemandST").setText(o);e.getView().byId("idDatePickerOnDemand").setValue(o);e.getView().byId("idSwitchInputD").setState(true);e.getView().byId("idDatePickerOnDemand").setEnabled(false);e.getView().getModel("oModel").setProperty("/dateValue",o)}else{e.getView().byId("idTextOnDemandST").setText(s.SPACE);e.getView().byId("idSwitchInputD").setState(false);e.getView().byId("idDatePickerOnDemand").setEnabled(true);e.getView().getModel("oModel").setProperty("/dateValue",s.SPACE)}if(i.SUSPENDTo!==undefined&&i.SUSPENDFrom!==undefined){var g=new Date(i.SUSPENDTo);var h=new Date(i.SUSPENDFrom);h=new Date(h.getTime()-h.getTimezoneOffset()*6e4);g=new Date(g.getTime()-g.getTimezoneOffset()*6e4);var l=h.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});var c=h.toDateString().replace(/^\S+\s/,""),V=c+s.SPACE+l;var w=g.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});var D=g.toDateString().replace(/^\S+\s/,""),p=D+s.SPACE+w;if(i.sActive===s.suspended){e.getView().byId("idDatePickerSuspend").setEnabled(false);e.getView().byId("idDatePicker2Suspend").setEnabled(false);e.getView().byId("idSwitchInputSuspend").setState(true);e.getView().byId("idInfoLabelSuspend").setVisible(true);e.getView().byId("idInfoLabelSuspend").setText(s.suspended);e.getView().byId("idInfoLabelSuspend").setColorScheme(2)}if(i.sActive===true){e.getView().byId("idDatePickerSuspend").setEnabled(false);e.getView().byId("idDatePicker2Suspend").setEnabled(false);e.getView().byId("idSwitchInputSuspend").setState(true)}e.getView().byId("idObjStatusS2").setText(p);e.getView().byId("idObjStatusS1").setText(V);e.getView().getModel("oModel").setProperty("/dateValueF",V);e.getView().getModel("oModel").setProperty("/dateValueT",p);e.getView().byId("idDatePickerSuspend").setValue(V);e.getView().byId("idDatePicker2Suspend").setValue(p)}else{e.getView().byId("idObjStatusS2").setText(s.SPACE);e.getView().byId("idObjStatusS1").setText(s.SPACE);e.getView().getModel("oModel").setProperty("/dateValueF",s.SPACE);e.getView().getModel("oModel").setProperty("/dateValueT",s.SPACE);e.getView().byId("idDatePickerSuspend").setEnabled(true);e.getView().byId("idDatePicker2Suspend").setEnabled(true);e.getView().byId("idSwitchInputSuspend").setState(false)}},error:function(i){a.hide();t.error(e.oBundle.getText("techError"),{details:i})}})},onRouteControl:function(){this.getJSTime()},onSwtichChange:function(e){a.show();var t=e.getSource().getState(),i=this.getView().byId("idTimePickerInput").getValue();this.getJSStatus(t,i)},getJSStatus:function(e,i){var d=this;this.oDataModelT.callFunction("/getJobDetails",{method:s.httpGet,success:function(r){a.hide();var n=JSON.parse(r.getJobDetails);if(n.sActive===s.suspended){if(e===false){d.getView().byId("idSwitchInput").setState(true)}else{d.getView().byId("idSwitchInput").setState(false)}d.getView().byId("idDatePickerSuspend").setEnabled(false);d.getView().byId("idDatePicker2Suspend").setEnabled(false);d.getView().byId("idSwitchInputSuspend").setState(true);d.getView().byId("idInfoLabelSuspend").setText(s.suspended);d.getView().byId("idInfoLabelSuspend").setColorScheme(2);t.error(d.oBundle.getText("susCheck"))}else{a.hide();d.executeSchDaily(e,i)}},error:function(e){a.hide();t.error(d.oBundle.getText("techError"),{details:e})}})},executeSchDaily:function(e,i){var d=this;if(e===false){this.getView().byId("idTimePickerInput").setEnabled(true);this.oDataModelT.callFunction("/updateSchedule",{method:s.httpGet,urlParameters:{desc:s.Recursive},success:function(e){a.hide();t.information(d.oBundle.getText("turnOffRecursive"))},error:function(e){a.hide();t.error(d.oBundle.getText("techError"),{details:e})}})}else{if(i!==""&&i!==s.SPACE&&i!==undefined){a.show();var r=new Date(this.getView().byId("idTimePickerInput").getDateValue()),n=r.getHours(),u=(r.getMinutes()<10?0:"")+r.getMinutes(),o=new Date;o.setHours(n);o.setMinutes(u);var l=new Date(o.getTime()+o.getTimezoneOffset()*6e4);var S=(l.getMinutes()<10?0:"")+l.getMinutes();var c=l.getHours()+":"+S;this.getView().byId("idTimePickerInput").setEnabled(false);this.getView().byId("idTextDailyST").setText(i);this.oDataModelT.callFunction("/createSchedule",{method:s.httpGet,urlParameters:{time:c,desc:s.Recursive},success:function(e){a.hide();t.success(d.oBundle.getText("succJSRecursive"))},error:function(e){a.hide();t.error(d.oBundle.getText("techError"),{details:e})}})}else{d.getView().byId("idSwitchInput").setState(false);t.error(d.oBundle.getText("manTime"))}}},onSwtichChangeD:function(e){a.show();var t=e.getSource().getState(),i=this.getView().byId("idDatePickerOnDemand").getValue();this.getJSStatusOnDemand(t,i)},getJSStatusOnDemand:function(e,i){var d=this;this.oDataModelT.callFunction("/getJobDetails",{method:s.httpGet,success:function(i){a.hide();var r=JSON.parse(i.getJobDetails);if(r.sActive===s.suspended){if(e===false){d.getView().byId("idSwitchInputD").setState(true)}else{d.getView().byId("idSwitchInputD").setState(false)}d.getView().byId("idInfoLabelSuspend").setText(s.suspended);d.getView().byId("idInfoLabelSuspend").setColorScheme(2);t.error(d.oBundle.getText("susCheck"))}else{d.executeSchOnDemand(e)}},error:function(e){a.hide();t.error(d.oBundle.getText("techError"),{details:e})}})},executeSchOnDemand:function(e){var i=this;if(e===false){i.getView().byId("idDatePickerOnDemand").setEnabled(true);i.oDataModelT.callFunction("/deleteSchedule",{method:s.httpGet,urlParameters:{desc:s.onDemand},success:function(e){a.hide();t.information(i.oBundle.getText("turnOffIn"));i.getView().byId("idDatePickerOnDemand").setValue("");i.getView().byId("idTextOnDemandST").setText(s.SPACE);i.getView().getModel("oModel").setProperty("/dateValue",s.SPACE)},error:function(e){a.hide();t.error(i.oBundle.getText("techError"),{details:e})}})}else{i.onPressSaveOnDemand()}},onPressSaveOnDemand:function(){var e=this.getView().byId("idDatePickerOnDemand").getValue(),i=this,a=this.getView().byId("idDatePickerOnDemand").getValueState(),d=new Date(e);var r=new Date;if(d<r){this.getView().byId("idDatePickerOnDemand").setValueState(sap.ui.core.ValueState.Error);t.error(this.oBundle.getText("dateError"))}else{var n=new Date(d.getTime()+d.getTimezoneOffset()*6e4);var u=n.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true}),o=n.toDateString()+s.SPACE+u;if(e!==""&&e!==s.SPACE&&e!==undefined){this.getView().byId("idDatePickerOnDemand").setEnabled(false);this.getView().byId("idTextOnDemandST").setText(o);this.getView().getModel("oModel").setProperty("/dateValue",e);this.oDataModelT.callFunction("/createOnDemandSchedule",{method:s.httpGet,urlParameters:{time:o,desc:s.onDemand},success:function(e){if(e.createOnDemandSchedule){t.success(i.oBundle.getText("succJSOD"))}},error:function(e){t.error(i.oBundle.getText("techError"),{details:e})}})}else{t.error(i.oBundle.getText("errormsgrequired"))}}},onSwtichChangeSuspend:function(e){var i=this;a.show();var d=e.getSource().getState();if(d===false){this.getView().byId("idDatePickerSuspend").setEnabled(true);this.getView().byId("idDatePicker2Suspend").setEnabled(true);i.oDataModelT.callFunction("/deleteSuspendSchedule",{method:s.httpGet,urlParameters:{desc:s.suspend},success:function(e){a.hide();i.getView().byId("idInfoLabelSuspend").setVisible(true);t.information(i.oBundle.getText("turnOffSus"))},error:function(e){a.hide();i.getView().byId("idSwitchInputSuspend").setState(true);i.getView().byId("idDatePickerSuspend").setEnabled(false);i.getView().byId("idDatePicker2Suspend").setEnabled(false);t.error(i.oBundle.getText("techError"),{details:e})}})}else{var r=this.getView().byId("idDatePickerSuspend").getValue(),n=this.getView().byId("idDatePicker2Suspend").getValue(),u=this.getView().byId("idDatePickerSuspend").getValueState(),o=this.getView().byId("idDatePicker2Suspend").getValueState(),l=[],i=this,S=new Date(r),c=new Date(n),g=new Date(S.getTime()+S.getTimezoneOffset()*6e4),h=new Date(c.getTime()+c.getTimezoneOffset()*6e4);var V=h.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true}),w=h.toDateString()+s.SPACE+V,D=g.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true}),p=g.toDateString()+s.SPACE+D;var b=new Date;if(c<b){a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);t.error(this.oBundle.getText("dateError"))}else{if(n!==""&&n!==s.SPACE&&n!==undefined&&(r!==""&&r!==s.SPACE&&r!==undefined)){if(u!==s.ERROR&&o!==s.ERROR){this.getView().byId("idDatePickerSuspend").setEnabled(false);this.getView().byId("idDatePicker2Suspend").setEnabled(false);this.getView().byId("idObjStatusS1").setText(r);this.getView().byId("idObjStatusS2").setText(n);this.getView().getModel("oModel").setProperty("/dateValueF",r);this.getView().getModel("oModel").setProperty("/dateValueT",n);l.push({time:p,Desc:"SUSPENDFROM"});l.push({time:w,Desc:"SUSPENDTO"});var I=JSON.stringify(l);i.oDataModelT.callFunction("/createSuspendSchedule",{method:s.httpGet,urlParameters:{time:I,desc:s.suspend},success:function(e){a.hide();var d=new Date;if(S<d){i.getView().byId("idInfoLabelSuspend").setVisible(true);i.getView().byId("idInfoLabelSuspend").setText(s.suspended);i.getView().byId("idInfoLabelSuspend").setColorScheme(2)}t.success(i.oBundle.getText("succJSSus"))},error:function(e){a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);i.getView().byId("idDatePickerSuspend").setEnabled(true);i.getView().byId("idDatePicker2Suspend").setEnabled(true);t.error(i.oBundle.getText("techError"),{details:e})}})}else{a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);i.getView().byId("idSwitchInputSuspend").setState(false);t.error(i.oBundle.getText("dateError"))}}else{a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);t.error(i.oBundle.getText("errormsgrequired"))}}}},onhandleChangeDP1Suspend:function(){var e=this.getView().byId("idDatePickerSuspend").getDateValue(),t=this.getView().byId("idDatePicker2Suspend").getDateValue();if(t!=null&&t<=e){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);this.getView().byId("idDatePicker2Suspend").setValueStateText(this.oBundle.getText("plcErrorDate"))}else{this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.None)}},onhandleChangeDP2Suspend:function(){var e=this.getView().byId("idDatePickerSuspend").getDateValue(),t=this.getView().byId("idDatePicker2Suspend").getDateValue();if(t<=e){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);this.getView().byId("idDatePicker2Suspend").setValueStateText(this.oBundle.getText("plcErrorDate"))}else if(e===null){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);this.getView().byId("idDatePicker2Suspend").setValueStateText(this.oBundle.getText("timeTo"))}else{this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.None)}},onhandleDateCheck:function(e){var i=e.getSource(),a=e.getParameter("value"),s=e.getParameter("valid");var d=new Date(a);var r=new Date;if(s){if(d<r){i.setValueState(sap.ui.core.ValueState.Error);t.error(this.oBundle.getText("dateError"))}else{i.setValueState(sap.ui.core.ValueState.None)}}else{i.setValueState(sap.ui.core.ValueState.Error)}},onhandleDateCheckSusFrom:function(e){var t=e.getSource(),i=e.getParameter("value"),a=e.getParameter("valid");var d=this.getView().byId("idDatePickerSuspend").getDateValue(),r=this.getView().byId("idDatePicker2Suspend").getDateValue();var n=new Date(i);var u=new Date,o=u.toLocaleString("en-US",{timeZone:s.timezone});o=new Date(o);if(a){if(n<o){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText(this.oBundle.getText("timeCurr"))}else if(r!=null&&r<=d){t.setValueState(sap.ui.core.ValueState.Error)}else{t.setValueState(sap.ui.core.ValueState.None)}}else{t.setValueState(sap.ui.core.ValueState.Error)}},onhandleDateCheckSusTo:function(e){var t=e.getSource(),i=e.getParameter("value"),a=e.getParameter("valid");var d=this.getView().byId("idDatePickerSuspend").getDateValue(),r=this.getView().byId("idDatePicker2Suspend").getDateValue();var n=new Date(i);var u=new Date,o=u.toLocaleString("en-US",{timeZone:s.timezone});o=new Date(o);if(a){if(n<o){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText(this.oBundle.getText("timeCurr"))}else if(d===null){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error)}else if(r<=d){t.setValueState(sap.ui.core.ValueState.Error)}else{t.setValueState(sap.ui.core.ValueState.None)}}else{t.setValueState(sap.ui.core.ValueState.Error)}}})});