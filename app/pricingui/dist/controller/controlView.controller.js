sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/core/BusyIndicator","demo/app/utils/constants"],function(e,t,i,a,r){"use strict";return e.extend("demo.app.controller.controlView",{onInit:function(){this.oBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.oDataModelT=this.getOwnerComponent().getModel();a.show();var e=new i;var t=[];e.setData(t);this.getView().setModel(e,"oModel");this.getOwnerComponent().setModel(e,"oModel");var r=sap.ui.core.UIComponent.getRouterFor(this);r.getRoute("RoutecontrolView").attachPatternMatched(this.onRouteControl,this)},getJSTime:function(){a.show();var e=this;this.oDataModelT.callFunction("/getJobDetails",{method:r.httpGet,success:function(t){a.hide();var i=JSON.parse(t.getJobDetails);if(i.RECURSIVE!==undefined){var s=new Date,d=i.RECURSIVE.indexOf(r.DIV),n=i.RECURSIVE.substring(r.INTZERO,d),u=i.RECURSIVE.substring(d+r.INTONE);s.setHours(n);s.setMinutes(u);var o=s.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});e.getView().byId("idTimePickerInput").setDateValue(s);e.getView().byId("idTextDailyST").setText(o);e.getView().byId("idSwitchInput").setState(true);e.getView().byId("idTimePickerInput").setEnabled(false)}else{e.getView().byId("idTextDailyST").setText(r.SPACE);e.getView().byId("idTimePickerInput").setValue(r.SPACE);e.getView().byId("idSwitchInput").setState(false);e.getView().byId("idTimePickerInput").setEnabled(true)}if(i.ONDEMAND!==undefined){var s=new Date(i.ONDEMAND);var o=s.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});var l=s.toDateString().replace(/^\S+\s/,""),c=l+r.SPACE+o;e.getView().byId("idTextOnDemandST").setText(c);e.getView().byId("idDatePickerOnDemand").setValue(c);e.getView().byId("idDatePickerOnDemand").setEnabled(false);e.getView().getModel("oModel").setProperty("/dateValue",c)}else{e.getView().byId("idTextOnDemandST").setText(r.SPACE);e.getView().getModel("oModel").setProperty("/dateValue",r.SPACE)}if(i.SUSPENDTo!==undefined&&i.SUSPENDFrom!==undefined){var S=new Date(i.SUSPENDTo);var g=new Date(i.SUSPENDFrom);g=new Date(g.getTime()-r.INTONE*r.INTSIXTY*r.INTSIXTY*r.INTTHOUS*r.INTSIX);var o=g.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});var l=g.toDateString().replace(/^\S+\s/,""),h=l+r.SPACE+o;var V=S.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});var w=S.toDateString().replace(/^\S+\s/,""),D=w+r.SPACE+V;if(i.sActive===r.suspended){e.getView().byId("idDatePickerSuspend").setEnabled(false);e.getView().byId("idDatePicker2Suspend").setEnabled(false);e.getView().byId("idSwitchInputSuspend").setState(true)}if(i.sActive===true){e.getView().byId("idDatePickerSuspend").setEnabled(false);e.getView().byId("idDatePicker2Suspend").setEnabled(false);e.getView().byId("idSwitchInputSuspend").setState(true)}e.getView().byId("idObjStatusS2").setText(D);e.getView().byId("idObjStatusS1").setText(h);e.getView().getModel("oModel").setProperty("/dateValueF",h);e.getView().getModel("oModel").setProperty("/dateValueT",D);e.getView().byId("idDatePickerSuspend").setValue(h);e.getView().byId("idDatePicker2Suspend").setValue(D)}else{e.getView().byId("idObjStatusS2").setText(r.SPACE);e.getView().byId("idObjStatusS1").setText(r.SPACE);e.getView().getModel("oModel").setProperty("/dateValueF",r.SPACE);e.getView().getModel("oModel").setProperty("/dateValueT",r.SPACE);e.getView().byId("idDatePickerSuspend").setEnabled(true);e.getView().byId("idDatePicker2Suspend").setEnabled(true);e.getView().byId("idSwitchInputSuspend").setState(false)}},error:function(i){a.hide();t.error(e.oBundle.getText("techError"),{details:i})}})},onRouteControl:function(){this.getJSTime()},onSwtichChange:function(e){a.show();var t=e.getSource().getState(),i=this.getView().byId("idTimePickerInput").getValue();this.getJSStatus(t,i)},getJSStatus:function(e,i){var s=this;this.oDataModelT.callFunction("/getJobDetails",{method:r.httpGet,success:function(d){a.hide();var n=JSON.parse(d.getJobDetails);if(n.sActive===r.suspended){if(e===false){s.getView().byId("idSwitchInput").setState(true)}else{s.getView().byId("idSwitchInput").setState(false)}s.getView().byId("idDatePickerSuspend").setEnabled(false);s.getView().byId("idDatePicker2Suspend").setEnabled(false);s.getView().byId("idSwitchInputSuspend").setState(true);t.error(s.oBundle.getText("susCheck"))}else{a.hide();s.executeSchDaily(e,i)}},error:function(e){a.hide();t.error(s.oBundle.getText("techError"),{details:e})}})},executeSchDaily:function(e,i){var s=this;if(e===false){this.getView().byId("idTimePickerInput").setEnabled(true);this.oDataModelT.callFunction("/updateSchedule",{method:r.httpGet,urlParameters:{desc:r.Recursive},success:function(e){a.hide();t.information(s.oBundle.getText("turnOffRecursive"))},error:function(e){a.hide();t.error(s.oBundle.getText("techError"),{details:e})}})}else{if(i!==""&&i!==r.SPACE&&i!==undefined){a.show();var d=new Date(this.getView().byId("idTimePickerInput").getDateValue()),n=d.getHours(),u=(d.getMinutes()<10?0:"")+d.getMinutes(),o=new Date;o.setHours(n);o.setMinutes(u);var l=o.toUTCString();var c=new Date(l);var S=(c.getMinutes()<10?0:"")+c.getMinutes();var g=c.getHours()+":"+S;this.getView().byId("idTimePickerInput").setEnabled(false);this.getView().byId("idTextDailyST").setText(i);this.oDataModelT.callFunction("/createSchedule",{method:r.httpGet,urlParameters:{time:g,desc:r.Recursive},success:function(e){a.hide();t.success(s.oBundle.getText("succJSRecursive"))},error:function(e){a.hide();t.error(s.oBundle.getText("techError"),{details:e})}})}else{s.getView().byId("idSwitchInput").setState(false);t.error(s.oBundle.getText("manTime"))}}},onPressOffOnDemand:function(){var e=this;t.confirm(e.oBundle.getText("offconfirm"),{onClose:function(i){if(i===r.actionOK){a.show();e.oDataModelT.callFunction("/deleteSchedule",{method:r.httpGet,urlParameters:{desc:r.onDemand},success:function(i){a.hide();t.information(e.oBundle.getText("turnOffIn"));e.getView().byId("idDatePickerOnDemand").setValue("");e.getView().byId("idTextOnDemandST").setText(r.SPACE);e.getView().getModel("oModel").setProperty("/dateValue",r.SPACE)},error:function(i){a.hide();t.error(e.oBundle.getText("techError"),{details:i})}})}}})},onPressSaveOnDemand:function(){var e=this.getView().byId("idDatePickerOnDemand").getValue(),i=this,a=this.getView().byId("idDatePickerOnDemand").getValueState(),s=new Date(e);var d=new Date;if(s<d){this.getView().byId("idDatePickerOnDemand").setValueState(sap.ui.core.ValueState.Error);t.error(this.oBundle.getText("dateError"))}else{var n=s.toUTCString();var u=new Date(n);var o=u.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true}),l=u.toDateString()+r.SPACE+o;if(e!==""&&e!==r.SPACE&&e!==undefined){this.getView().byId("idDatePickerOnDemand").setEnabled(false);this.getView().byId("idTextOnDemandST").setText(l);this.getView().getModel("oModel").setProperty("/dateValue",e);this.oDataModelT.callFunction("/createOnDemandSchedule",{method:r.httpGet,urlParameters:{time:l,desc:r.onDemand},success:function(e){if(e.createOnDemandSchedule){t.success(i.oBundle.getText("succJSOD"))}},error:function(e){t.error(i.oBundle.getText("techError"),{details:e})}})}else{t.error(i.oBundle.getText("errormsgrequired"))}}},onSwtichChangeSuspend:function(e){var i=this;a.show();var s=e.getSource().getState();if(s===false){this.getView().byId("idDatePickerSuspend").setEnabled(true);this.getView().byId("idDatePicker2Suspend").setEnabled(true);i.oDataModelT.callFunction("/deleteSuspendSchedule",{method:r.httpGet,urlParameters:{desc:r.suspend},success:function(e){a.hide();t.information(i.oBundle.getText("turnOffSus"))},error:function(e){a.hide();i.getView().byId("idSwitchInputSuspend").setState(true);i.getView().byId("idDatePickerSuspend").setEnabled(false);i.getView().byId("idDatePicker2Suspend").setEnabled(false);t.error(i.oBundle.getText("techError"),{details:e})}})}else{var d=this.getView().byId("idDatePickerSuspend").getValue(),n=this.getView().byId("idDatePicker2Suspend").getValue(),u=this.getView().byId("idDatePickerSuspend").getValueState(),o=this.getView().byId("idDatePicker2Suspend").getValueState(),l=[],i=this,c=new Date(d),S=new Date(n),g=c.toUTCString(),h=S.toUTCString(),V=new Date(g),w=new Date(h);var D=w.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true}),p=w.toDateString()+r.SPACE+D,I=V.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true}),b=V.toDateString()+r.SPACE+I;var f=new Date;if(S<f){a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);t.error(this.oBundle.getText("dateError"))}else{if(n!==""&&n!==r.SPACE&&n!==undefined&&(d!==""&&d!==r.SPACE&&d!==undefined)){if(u!==r.ERROR&&o!==r.ERROR){this.getView().byId("idDatePickerSuspend").setEnabled(false);this.getView().byId("idDatePicker2Suspend").setEnabled(false);this.getView().byId("idObjStatusS1").setText(d);this.getView().byId("idObjStatusS2").setText(n);this.getView().getModel("oModel").setProperty("/dateValueF",d);this.getView().getModel("oModel").setProperty("/dateValueT",n);l.push({time:b,Desc:"SUSPENDFROM"});l.push({time:p,Desc:"SUSPENDTO"});var P=JSON.stringify(l);i.oDataModelT.callFunction("/createSuspendSchedule",{method:r.httpGet,urlParameters:{time:P,desc:r.suspend},success:function(e){a.hide();t.success(i.oBundle.getText("succJSSus"))},error:function(e){a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);i.getView().byId("idDatePickerSuspend").setEnabled(true);i.getView().byId("idDatePicker2Suspend").setEnabled(true);t.error(i.oBundle.getText("techError"),{details:e})}})}else{a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);i.getView().byId("idSwitchInputSuspend").setState(false);t.error(i.oBundle.getText("dateError"))}}else{a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);t.error(i.oBundle.getText("errormsgrequired"))}}}},onhandleChangeDP1Suspend:function(){var e=this.getView().byId("idDatePickerSuspend").getDateValue(),t=this.getView().byId("idDatePicker2Suspend").getDateValue();if(t!=null&&t<=e){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);this.getView().byId("idDatePicker2Suspend").setValueStateText(this.oBundle.getText("plcErrorDate"))}else{this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.None)}},onhandleChangeDP2Suspend:function(){var e=this.getView().byId("idDatePickerSuspend").getDateValue(),t=this.getView().byId("idDatePicker2Suspend").getDateValue();if(t<=e){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);this.getView().byId("idDatePicker2Suspend").setValueStateText(this.oBundle.getText("plcErrorDate"))}else if(e===null){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);this.getView().byId("idDatePicker2Suspend").setValueStateText(this.oBundle.getText("timeTo"))}else{this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.None)}},onhandleDateCheck:function(e){var i=e.getSource(),a=e.getParameter("value"),s=e.getParameter("valid");var d=new Date(a);var n=new Date,u=n.toLocaleString("en-US",{timeZone:r.timezone});u=new Date(u);if(s){if(d<u){i.setValueState(sap.ui.core.ValueState.Error);t.error(this.oBundle.getText("dateError"))}else{i.setValueState(sap.ui.core.ValueState.None)}}else{i.setValueState(sap.ui.core.ValueState.Error)}},onhandleDateCheckSusFrom:function(e){var t=e.getSource(),i=e.getParameter("value"),a=e.getParameter("valid");var s=this.getView().byId("idDatePickerSuspend").getDateValue(),d=this.getView().byId("idDatePicker2Suspend").getDateValue();var n=new Date(i);var u=new Date,o=u.toLocaleString("en-US",{timeZone:r.timezone});o=new Date(o);if(a){if(n<o){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText(this.oBundle.getText("timeCurr"))}else if(d!=null&&d<=s){t.setValueState(sap.ui.core.ValueState.Error)}else{t.setValueState(sap.ui.core.ValueState.None)}}else{t.setValueState(sap.ui.core.ValueState.Error)}},onhandleDateCheckSusTo:function(e){var t=e.getSource(),i=e.getParameter("value"),a=e.getParameter("valid");var s=this.getView().byId("idDatePickerSuspend").getDateValue(),d=this.getView().byId("idDatePicker2Suspend").getDateValue();var n=new Date(i);var u=new Date,o=u.toLocaleString("en-US",{timeZone:r.timezone});o=new Date(o);if(a){if(n<o){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText(this.oBundle.getText("timeCurr"))}else if(s===null){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error)}else if(d<=s){t.setValueState(sap.ui.core.ValueState.Error)}else{t.setValueState(sap.ui.core.ValueState.None)}}else{t.setValueState(sap.ui.core.ValueState.Error)}}})});