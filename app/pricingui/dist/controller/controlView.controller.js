sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageBox","sap/ui/model/json/JSONModel","sap/ui/core/BusyIndicator","demo/app/utils/constants"],function(e,t,i,a,r){"use strict";return e.extend("demo.app.controller.controlView",{onInit:function(){this.oBundle=this.getOwnerComponent().getModel("i18n").getResourceBundle();this.oDataModelT=this.getOwnerComponent().getModel();a.show();var e=new i;var t=[];e.setData(t);this.getView().setModel(e,"oModel");this.getOwnerComponent().setModel(e,"oModel");var r=sap.ui.core.UIComponent.getRouterFor(this);r.getRoute("RoutecontrolView").attachPatternMatched(this.onRouteControl,this)},getJSTime:function(){a.show();var e=this;this.oDataModelT.callFunction("/getJobDetails",{method:r.httpGet,success:function(t){a.hide();var i=JSON.parse(t.getJobDetails);if(i.RECURSIVE!==undefined){var s=new Date,d=i.RECURSIVE.indexOf(r.DIV),n=i.RECURSIVE.substring(r.INTZERO,d),u=i.RECURSIVE.substring(d+r.INTONE);s.setHours(n);s.setMinutes(u);var o=new Date(s.getTime()-s.getTimezoneOffset()*6e4);var l=o.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});e.getView().byId("idTimePickerInput").setDateValue(o);e.getView().byId("idTextDailyST").setText(l);e.getView().byId("idSwitchInput").setState(true);e.getView().byId("idTimePickerInput").setEnabled(false)}else{e.getView().byId("idTextDailyST").setText(r.SPACE);e.getView().byId("idTimePickerInput").setValue(r.SPACE);e.getView().byId("idSwitchInput").setState(false);e.getView().byId("idTimePickerInput").setEnabled(true)}if(i.ONDEMAND!==undefined){var s=new Date(i.ONDEMAND);var c=new Date(s.getTime()-s.getTimezoneOffset()*6e4);var l=c.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});var S=c.toDateString().replace(/^\S+\s/,""),o=S+r.SPACE+l;e.getView().byId("idTextOnDemandST").setText(o);e.getView().byId("idDatePickerOnDemand").setValue(o);e.getView().byId("idSwitchInputD").setState(true);e.getView().byId("idDatePickerOnDemand").setEnabled(false);e.getView().getModel("oModel").setProperty("/dateValue",o)}else{e.getView().byId("idTextOnDemandST").setText(r.SPACE);e.getView().byId("idSwitchInputD").setState(false);e.getView().byId("idDatePickerOnDemand").setEnabled(true);e.getView().getModel("oModel").setProperty("/dateValue",r.SPACE)}if(i.SUSPENDTo!==undefined&&i.SUSPENDFrom!==undefined){var g=new Date(i.SUSPENDTo);var h=new Date(i.SUSPENDFrom);h=new Date(h.getTime()-h.getTimezoneOffset()*6e4);g=new Date(g.getTime()-g.getTimezoneOffset()*6e4);var l=h.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});var S=h.toDateString().replace(/^\S+\s/,""),V=S+r.SPACE+l;var w=g.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true});var D=g.toDateString().replace(/^\S+\s/,""),p=D+r.SPACE+w;if(i.sActive===r.suspended){e.getView().byId("idDatePickerSuspend").setEnabled(false);e.getView().byId("idDatePicker2Suspend").setEnabled(false);e.getView().byId("idSwitchInputSuspend").setState(true);e.getView().byId("idInfoLabelSuspend").setVisible(true);e.getView().byId("idInfoLabelSuspend").setText(r.suspended);e.getView().byId("idInfoLabelSuspend").setColorScheme(2)}if(i.sActive===true){e.getView().byId("idDatePickerSuspend").setEnabled(false);e.getView().byId("idDatePicker2Suspend").setEnabled(false);e.getView().byId("idSwitchInputSuspend").setState(true)}e.getView().byId("idObjStatusS2").setText(p);e.getView().byId("idObjStatusS1").setText(V);e.getView().getModel("oModel").setProperty("/dateValueF",V);e.getView().getModel("oModel").setProperty("/dateValueT",p);e.getView().byId("idDatePickerSuspend").setValue(V);e.getView().byId("idDatePicker2Suspend").setValue(p)}else{e.getView().byId("idObjStatusS2").setText(r.SPACE);e.getView().byId("idObjStatusS1").setText(r.SPACE);e.getView().getModel("oModel").setProperty("/dateValueF",r.SPACE);e.getView().getModel("oModel").setProperty("/dateValueT",r.SPACE);e.getView().byId("idDatePickerSuspend").setEnabled(true);e.getView().byId("idDatePicker2Suspend").setEnabled(true);e.getView().byId("idSwitchInputSuspend").setState(false)}},error:function(i){a.hide();t.error(e.oBundle.getText("techError"),{details:i})}})},onRouteControl:function(){this.getJSTime()},onSwtichChange:function(e){a.show();var t=e.getSource().getState(),i=this.getView().byId("idTimePickerInput").getValue();this.getJSStatus(t,i)},getJSStatus:function(e,i){var s=this;this.oDataModelT.callFunction("/getJobDetails",{method:r.httpGet,success:function(d){a.hide();var n=JSON.parse(d.getJobDetails);if(n.sActive===r.suspended){if(e===false){s.getView().byId("idSwitchInput").setState(true)}else{s.getView().byId("idSwitchInput").setState(false)}s.getView().byId("idDatePickerSuspend").setEnabled(false);s.getView().byId("idDatePicker2Suspend").setEnabled(false);s.getView().byId("idSwitchInputSuspend").setState(true);s.getView().byId("idInfoLabelSuspend").setText(r.suspended);s.getView().byId("idInfoLabelSuspend").setColorScheme(2);t.error(s.oBundle.getText("susCheck"))}else{a.hide();s.executeSchDaily(e,i)}},error:function(e){a.hide();t.error(s.oBundle.getText("techError"),{details:e})}})},executeSchDaily:function(e,i){var s=this;if(e===false){this.getView().byId("idTimePickerInput").setEnabled(true);this.oDataModelT.callFunction("/updateSchedule",{method:r.httpGet,urlParameters:{desc:r.Recursive},success:function(e){a.hide();t.information(s.oBundle.getText("turnOffRecursive"))},error:function(e){a.hide();t.error(s.oBundle.getText("techError"),{details:e})}})}else{if(i!==""&&i!==r.SPACE&&i!==undefined){a.show();var d=new Date(this.getView().byId("idTimePickerInput").getDateValue()),n=d.getHours(),u=(d.getMinutes()<10?0:"")+d.getMinutes(),o=new Date;o.setHours(n);o.setMinutes(u);var l=new Date(o.getTime()+o.getTimezoneOffset()*6e4);var c=(l.getMinutes()<10?0:"")+l.getMinutes();var S=l.getHours()+":"+c;this.getView().byId("idTimePickerInput").setEnabled(false);this.getView().byId("idTextDailyST").setText(i);this.oDataModelT.callFunction("/createSchedule",{method:r.httpGet,urlParameters:{time:S,desc:r.Recursive},success:function(e){a.hide();t.success(s.oBundle.getText("succJSRecursive"))},error:function(e){a.hide();t.error(s.oBundle.getText("techError"),{details:e})}})}else{s.getView().byId("idSwitchInput").setState(false);t.error(s.oBundle.getText("manTime"))}}},onSwtichChangeD:function(e){a.show();var t=e.getSource().getState(),i=this.getView().byId("idDatePickerOnDemand").getValue();this.getJSStatusOnDemand(t,i)},getJSStatusOnDemand:function(e,i){var s=this;this.oDataModelT.callFunction("/getJobDetails",{method:r.httpGet,success:function(i){a.hide();var d=JSON.parse(i.getJobDetails);if(d.sActive===r.suspended){if(e===false){s.getView().byId("idSwitchInputD").setState(true)}else{s.getView().byId("idSwitchInputD").setState(false)}s.getView().byId("idInfoLabelSuspend").setText(r.suspended);s.getView().byId("idInfoLabelSuspend").setColorScheme(2);t.error(s.oBundle.getText("susCheck"))}else{s.executeSchOnDemand(e)}},error:function(e){a.hide();t.error(s.oBundle.getText("techError"),{details:e})}})},executeSchOnDemand:function(e){var i=this;if(e===false){i.getView().byId("idDatePickerOnDemand").setEnabled(true);i.oDataModelT.callFunction("/deleteSchedule",{method:r.httpGet,urlParameters:{desc:r.onDemand},success:function(e){a.hide();t.information(i.oBundle.getText("turnOffIn"));i.getView().byId("idDatePickerOnDemand").setValue("");i.getView().byId("idTextOnDemandST").setText(r.SPACE);i.getView().getModel("oModel").setProperty("/dateValue",r.SPACE)},error:function(e){a.hide();t.error(i.oBundle.getText("techError"),{details:e})}})}else{i.onPressSaveOnDemand()}},onPressSaveOnDemand:function(){var e=this.getView().byId("idDatePickerOnDemand").getValue(),i=this,a=this.getView().byId("idDatePickerOnDemand").getValueState(),s=new Date(e);var d=new Date;if(s<d){this.getView().byId("idDatePickerOnDemand").setValueState(sap.ui.core.ValueState.Error);t.error(this.oBundle.getText("dateError"))}else{var n=new Date(s.getTime()+s.getTimezoneOffset()*6e4);var u=n.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true}),o=n.toDateString()+r.SPACE+u;if(e!==""&&e!==r.SPACE&&e!==undefined){this.getView().byId("idDatePickerOnDemand").setEnabled(false);this.getView().byId("idTextOnDemandST").setText(o);this.getView().getModel("oModel").setProperty("/dateValue",e);this.oDataModelT.callFunction("/createOnDemandSchedule",{method:r.httpGet,urlParameters:{time:o,desc:r.onDemand},success:function(e){if(e.createOnDemandSchedule){t.success(i.oBundle.getText("succJSOD"))}},error:function(e){t.error(i.oBundle.getText("techError"),{details:e})}})}else{t.error(i.oBundle.getText("errormsgrequired"))}}},onSwtichChangeSuspend:function(e){var i=this;a.show();var s=e.getSource().getState();if(s===false){this.getView().byId("idDatePickerSuspend").setEnabled(true);this.getView().byId("idDatePicker2Suspend").setEnabled(true);i.oDataModelT.callFunction("/deleteSuspendSchedule",{method:r.httpGet,urlParameters:{desc:r.suspend},success:function(e){a.hide();t.information(i.oBundle.getText("turnOffSus"))},error:function(e){a.hide();i.getView().byId("idSwitchInputSuspend").setState(true);i.getView().byId("idDatePickerSuspend").setEnabled(false);i.getView().byId("idDatePicker2Suspend").setEnabled(false);t.error(i.oBundle.getText("techError"),{details:e})}})}else{var d=this.getView().byId("idDatePickerSuspend").getValue(),n=this.getView().byId("idDatePicker2Suspend").getValue(),u=this.getView().byId("idDatePickerSuspend").getValueState(),o=this.getView().byId("idDatePicker2Suspend").getValueState(),l=[],i=this,c=new Date(d),S=new Date(n),g=new Date(c.getTime()+c.getTimezoneOffset()*6e4),h=new Date(S.getTime()+S.getTimezoneOffset()*6e4);var V=h.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true}),w=h.toDateString()+r.SPACE+V,D=g.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:true}),p=g.toDateString()+r.SPACE+D;var b=new Date;if(S<b){a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);t.error(this.oBundle.getText("dateError"))}else{if(n!==""&&n!==r.SPACE&&n!==undefined&&(d!==""&&d!==r.SPACE&&d!==undefined)){if(u!==r.ERROR&&o!==r.ERROR){this.getView().byId("idDatePickerSuspend").setEnabled(false);this.getView().byId("idDatePicker2Suspend").setEnabled(false);this.getView().byId("idObjStatusS1").setText(d);this.getView().byId("idObjStatusS2").setText(n);this.getView().getModel("oModel").setProperty("/dateValueF",d);this.getView().getModel("oModel").setProperty("/dateValueT",n);l.push({time:p,Desc:"SUSPENDFROM"});l.push({time:w,Desc:"SUSPENDTO"});var I=JSON.stringify(l);i.oDataModelT.callFunction("/createSuspendSchedule",{method:r.httpGet,urlParameters:{time:I,desc:r.suspend},success:function(e){a.hide();t.success(i.oBundle.getText("succJSSus"))},error:function(e){a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);i.getView().byId("idDatePickerSuspend").setEnabled(true);i.getView().byId("idDatePicker2Suspend").setEnabled(true);t.error(i.oBundle.getText("techError"),{details:e})}})}else{a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);i.getView().byId("idSwitchInputSuspend").setState(false);t.error(i.oBundle.getText("dateError"))}}else{a.hide();i.getView().byId("idSwitchInputSuspend").setState(false);t.error(i.oBundle.getText("errormsgrequired"))}}}},onhandleChangeDP1Suspend:function(){var e=this.getView().byId("idDatePickerSuspend").getDateValue(),t=this.getView().byId("idDatePicker2Suspend").getDateValue();if(t!=null&&t<=e){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);this.getView().byId("idDatePicker2Suspend").setValueStateText(this.oBundle.getText("plcErrorDate"))}else{this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.None)}},onhandleChangeDP2Suspend:function(){var e=this.getView().byId("idDatePickerSuspend").getDateValue(),t=this.getView().byId("idDatePicker2Suspend").getDateValue();if(t<=e){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);this.getView().byId("idDatePicker2Suspend").setValueStateText(this.oBundle.getText("plcErrorDate"))}else if(e===null){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error);this.getView().byId("idDatePicker2Suspend").setValueStateText(this.oBundle.getText("timeTo"))}else{this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.None)}},onhandleDateCheck:function(e){var i=e.getSource(),a=e.getParameter("value"),s=e.getParameter("valid");var d=new Date(a);var n=new Date,u=n.toLocaleString("en-US",{timeZone:r.timezone});u=new Date(u);if(s){if(d<u){i.setValueState(sap.ui.core.ValueState.Error);t.error(this.oBundle.getText("dateError"))}else{i.setValueState(sap.ui.core.ValueState.None)}}else{i.setValueState(sap.ui.core.ValueState.Error)}},onhandleDateCheckSusFrom:function(e){var t=e.getSource(),i=e.getParameter("value"),a=e.getParameter("valid");var s=this.getView().byId("idDatePickerSuspend").getDateValue(),d=this.getView().byId("idDatePicker2Suspend").getDateValue();var n=new Date(i);var u=new Date,o=u.toLocaleString("en-US",{timeZone:r.timezone});o=new Date(o);if(a){if(n<o){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText(this.oBundle.getText("timeCurr"))}else if(d!=null&&d<=s){t.setValueState(sap.ui.core.ValueState.Error)}else{t.setValueState(sap.ui.core.ValueState.None)}}else{t.setValueState(sap.ui.core.ValueState.Error)}},onhandleDateCheckSusTo:function(e){var t=e.getSource(),i=e.getParameter("value"),a=e.getParameter("valid");var s=this.getView().byId("idDatePickerSuspend").getDateValue(),d=this.getView().byId("idDatePicker2Suspend").getDateValue();var n=new Date(i);var u=new Date,o=u.toLocaleString("en-US",{timeZone:r.timezone});o=new Date(o);if(a){if(n<o){t.setValueState(sap.ui.core.ValueState.Error);t.setValueStateText(this.oBundle.getText("timeCurr"))}else if(s===null){this.getView().byId("idDatePicker2Suspend").setValueState(sap.ui.core.ValueState.Error)}else if(d<=s){t.setValueState(sap.ui.core.ValueState.Error)}else{t.setValueState(sap.ui.core.ValueState.None)}}else{t.setValueState(sap.ui.core.ValueState.Error)}}})});